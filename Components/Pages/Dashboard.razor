@page "/home"
@using MoneyManager.Models
@using MoneyManager.Services
@inject ITransactionService transactionService
@inject AuthenticationStateService authStateService

<style>
    /* General page styling */
    body {
        font-family: Arial, sans-serif;
        background-color: #f9f9f9;
        margin: 0;
        padding: 0;
    }

    h3{
     text-align: center;
     font-family: 'Times New Roman', Times, Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif;
    }

    h1, h2 {
        text-align: center;
        margin-bottom: 20px;
    }

    h1 {
        margin-top: 20px;
    }

    .dashboard-container {
        max-width: 800px;
        margin: 0 auto;
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
        justify-content: center;
        padding: 20px;
    }

    .dashboard-item {
        flex: 1 1 calc(50% - 20px); /* Each item takes 50% width, minus spacing */
        background-color: #ffffff;
        border: 2px solid #000000;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        padding: 20px;
        text-align: center;
        min-width: 250px;
    }

    .dashboard-item h4 {
        font-size: 1.2rem;
        margin-bottom: 10px;
    }

    .dashboard-item p {
        font-size: 1.1rem;
        margin: 0;
        font-weight: bold;
        color: deeppink;
    }

    /* Responsive Design */
    @*:@media (max-width: 768px) {
        .dashboard-item {
            flex: 1 1 100%; /* Full width for smaller screens */
        }*@
    }
</style>



<h1>Welcome, @authStateService.GetAuthenticatedUser().Name!</h1>

@if (authStateService.IsAuthenticated())
{
    <h2>Your Currency: @authStateService.GetAuthenticatedUser().Currency</h2>
    <h3>Dashboard Summary</h3>

    <div class="dashboard-container">
        <div class="dashboard-item">
        <h4>Total Inflow:</h4>
        <p>@authStateService.GetAuthenticatedUser().Currency @totalInflow</p>
        </div>
         <div class="dashboard-item">
         <h4>Total Outflow:</h4>
        <p>@authStateService.GetAuthenticatedUser().Currency @totalOutflow</p>
        </div>
        @* <p><strong>Total Debt: </strong>@authStateService.GetAuthenticatedUser().Currency @totalDebt</p>*@
         <div class="dashboard-item">
         <h4>Paid Debt:</h4>
        <p>@authStateService.GetAuthenticatedUser().Currency @paidDebt</p>
        </div>
         <div class="dashboard-item">
         <h4>Remaining Debt:</h4>
        <p>@authStateService.GetAuthenticatedUser().Currency @remainingDebt</p>
        </div>
         <div class="dashboard-item">
         <h4>Total Balance: </h4>
        <p>@authStateService.GetAuthenticatedUser().Currency @totalBalance</p>
        </div>
    </div>
}

@code {
    private decimal totalInflow;
    private decimal totalOutflow;
    private decimal totalDebt;
    private decimal paidDebt;
    private decimal remainingDebt;
    private decimal totalBalance;

    protected override async Task OnInitializedAsync()
    {
        await LoadAndCalculateTotals();
    }

    private async Task LoadAndCalculateTotals()
    {
        var transactions = await transactionService.LoadTransactionAsync();

        totalInflow = transactions.Where(t => t.Type == "Inflow").Sum(t => t.Amount);
        totalOutflow = transactions.Where(t => t.Type == "Outflow").Sum(t => t.Amount);
        totalDebt = transactions.Where(t => t.Type == "Debt").Sum(t => t.Amount);
        paidDebt = transactions.Where(t => t.Type == "Debt" && t.IsPaid).Sum(t => t.Amount);
        remainingDebt = totalDebt - paidDebt;
        totalBalance = totalInflow - totalOutflow - paidDebt;
    }
}
